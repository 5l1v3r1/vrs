<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>::WA_Title_Options:: - ::WA_Title_WebAdmin::</title>
        @head.html@
        <script src="../script/webadmin/jquery-ui.js" type="text/javascript"></script>
        <script src="../script/webadmin/knockout.js" type="text/javascript"></script>
        <script src="../script/webadmin/knockout.mapping.js" type="text/javascript"></script>
        <script src="../script/webadmin/jquiplugin/bootstrap-form.js" type="text/javascript"></script>
        <!-- [[ BUNDLE END ]] -->
    </head>
    <body>
        <div id="page-container">
            <div id="content" class="container-fluid">
                <div class="row row-offcanvas row-offcanvas-left">
                    <div class="col-xs-12 col-sm-9">
                        <h1 class="page-header">
                            ::WA_Title_Options::
                        </h1>

                        <form>
                            <div id="form-container">
                                <div id="page-general" data-vrs-plugin="form-page" data-vrs-title="::OptionsGeneralCategory::">
                                    <div data-vrs-bind="Configuration.FlightRouteSettings.AutoUpdateEnabled"        data-vrs-title="::AutomaticallyDownloadNewRoutes::" data-vrs-plugin="field-checkbox"></div>
                                    <div data-vrs-bind="Configuration.VersionCheckSettings.CheckAutomatically"      data-vrs-title="::CheckForNewVersions::"            data-vrs-plugin="field-checkbox"></div>
                                </div>
                                <div id="page-data-sources" data-vrs-plugin="form-page" data-vrs-title="::OptionsDataSourcesSheetTitle::">
                                    <div data-vrs-bind="Configuration.BaseStationSettings.DatabaseFileName"         data-vrs-title="::DatabaseFileName::"           data-vrs-plugin="field-text"></div>
                                    <div data-vrs-bind="Configuration.BaseStationSettings.OperatorFlagsFolder"      data-vrs-title="::FlagsFolder::"                data-vrs-plugin="field-text"></div>
                                    <div data-vrs-bind="Configuration.BaseStationSettings.SilhouettesFolder"        data-vrs-title="::SilhouettesFolder::"          data-vrs-plugin="field-text"></div>
                                    <div data-vrs-bind="Configuration.BaseStationSettings.PicturesFolder"           data-vrs-title="::PicturesFolder::"             data-vrs-plugin="field-text"></div>
                                    <div data-vrs-bind="Configuration.BaseStationSettings.SearchPictureSubFolders"  data-vrs-title="::SearchPictureSubFolders::"    data-vrs-plugin="field-checkbox"></div>
                                </div>
                                <div id="page-receivers" data-vrs-plugin="form-page" data-vrs-title="::Receivers::">
                                    <div data-vrs-bind="Configuration.Receivers" data-vrs-plugin="field-list">
                                        <div data-vrs-plugin="list-columns">
                                            <div data-vrs-bind="enabledYesNo"           data-vrs-title="::Enabled::"></div>
                                            <div data-vrs-bind="Name"                   data-vrs-title="::Name::"></div>
                                            <div data-vrs-bind="dataSourceText"         data-vrs-title="::Format::"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                Revision: <span data-bind="text: Configuration.DataVersion"></span>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <script type="text/javascript">
            (function(VRS, $, undefined)
            {
                //region ViewModel mapping options
                var _ViewModel = {};
                var _ViewMapping = {
                    create: function(options)
                    {
                        var model = ko.mapping.fromJS(options.data);

                        $.each(model.Configuration.Receivers(), function(idx, receiver) {
                            receiver.enabledYesNo = ko.computed(function() {
                                return this.Enabled() ? '::Yes::' : '::No::'
                            }, receiver);
                            receiver.dataSourceText = ko.computed(function () {
                                var dataSource = this.DataSource();
                                return $.isNumeric(dataSource) ? options.data.DataSources[dataSource] : '';
                            }, receiver);
                        });

                        return model;
                    }
                };
                //endregion

                //region SettingsView
                VRS.WebAdmin.SettingsView = function(settings)
                {
                    VRS.WebAdmin.View.call(this, settings);

                    this.addElements = function()
                    {
                        $('#form-container').bootstrapForm();
                    };

                    /**
                        * Shows the content sent from the server.
                        * @param {VRS_WEBADMIN_VIEWDATA_SETTINGS} data
                        */
                    this.showContent = function(data)
                    {
                        _ViewModel = ko.mapping.fromJS(data, _ViewMapping);
                        ko.applyBindings(_ViewModel);
                    };
                };
                VRS.WebAdmin.SettingsView.prototype = VRS.objectHelper.subclassOf(VRS.WebAdmin.View);
                //endregion

                var settingsView = new VRS.WebAdmin.SettingsView({
                    pageUrl: 'Options.html',
                    jsonUrl: 'Options.json',
                    refreshPeriod: 0
                });
                settingsView.initialise();
            }(window.VRS = window.VRS || {}, jQuery));
        </script>
    </body>
</html>
